<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wie Wat Status</title>
  <link rel="stylesheet" href="css/styles.css">
  <!-- Firebase SDK Integration -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js";
    import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCHN_JjJdkVAwtsr-brohVo28nV3-YdnSA",
      authDomain: "wiewatstatus.firebaseapp.com",
      projectId: "wiewatstatus",
      storageBucket: "wiewatstatus.appspot.com",
      messagingSenderId: "65233657379",
      appId: "1:65233657379:web:dde1290d3a05dcf68edb96",
      measurementId: "G-53E0YL250H"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    window.db = db;
    window.collection = collection;
    window.addDoc = addDoc;
    window.onSnapshot = onSnapshot;
    window.auth = auth;
    window.signInWithEmailAndPassword = signInWithEmailAndPassword;
    window.signOut = signOut;
    window.onAuthStateChanged = onAuthStateChanged;
  </script>
</head>
<body>
  <button id="loginButton" class="login-button">Admin Login</button>
  <button id="logoutButton" class="logout-button" style="display:none;">Log Out</button>

  <!-- Login Modal -->
  <div id="loginModal" class="modal" style="display: none;">
    <div class="modal-content">
      <span id="closeModal" class="close">&times;</span>
      <h2>Admin Login</h2>
      <form id="loginForm">
        <input type="email" id="loginEmail" placeholder="Email" required>
        <input type="password" id="loginPassword" placeholder="Password" required>
        <button type="submit">Login</button>
      </form>
    </div>
  </div>

  <div class="form-container">
    <h2>Voeg een mapping toe</h2>
    <div class="content" style="display: none;">
      <form id="dataForm">
        <!-- Existing fields -->
        <input type="text" id="gemeente" placeholder="Gemeente" required>
        <input type="text" id="contactpersoon" placeholder="Contactpersoon" required>
        <input type="text" id="onderwerp" placeholder="Onderwerp" required>
        <input type="text" id="subonderwerp" placeholder="Sub-onderwerp" required>
        <input type="text" id="bron" placeholder="Bron" required>
        <input type="text" id="status" placeholder="Status" required>

        <!-- Honeypot field: invisible to real users -->
        <input type="text" id="honeypot" name="honeypot" style="display:none;" autocomplete="off">

        <button type="submit">Voeg toe</button>
      </form>
    </div>
  </div>
  
  <div class="table-container">
    <h2>Wie Wat Status</h2> 
    <table id="recordsTable">
      <thead>
        <tr>
          <th>Gemeente</th>
          <th>Contactpersoon</th>
          <th>Onderwerp</th>
          <th>Subonderwerp</th>
          <th>Bron</th>
          <th>Status</th>
          <th class="action-column" style="display: none;">Actie</th>
        </tr>
      </thead>
      <tbody id="records"></tbody>
    </table>
  </div>

  <script type="module" src="js/scripts.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const collapsibleHeader = document.querySelector('.form-container h2');
      const content = document.querySelector('.content');
      const loginButton = document.getElementById('loginButton');
      const logoutButton = document.getElementById('logoutButton');
      const loginModal = document.getElementById('loginModal');
      const closeModal = document.getElementById('closeModal');
      const loginForm = document.getElementById('loginForm');
      const actionColumn = document.querySelector('.action-column');

      // Toggle form content visibility
      collapsibleHeader.addEventListener('click', () => {
        const isVisible = content.style.display === 'block';
        content.style.display = isVisible ? 'none' : 'block';
      });

      // Open login modal
      loginButton.addEventListener('click', () => {
        console.log('Opening login modal...');
        loginModal.style.display = 'block';
      });

      // Close the modal
      closeModal.addEventListener('click', () => {
        loginModal.style.display = 'none';
      });

      // Handle login form submission
      loginForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;

        signInWithEmailAndPassword(auth, email, password)
          .then((userCredential) => {
            // Successfully logged in
            loginModal.style.display = 'none';
            loginButton.style.display = 'none';
            logoutButton.style.display = 'inline-block';
            actionColumn.style.display = 'table-cell';
            
          })
          .catch((error) => {
            console.error('Error signing in: ', error);
            alert('Failed to log in. Please check your credentials.');
          });
      });

      // Handle logout button click
      logoutButton.addEventListener('click', () => {
        console.log('Logging out...');
        signOut(auth).then(() => {
          
          loginButton.style.display = 'inline-block';
          logoutButton.style.display = 'none';
          actionColumn.style.display = 'none';
        }).catch((error) => {
          console.error('Error logging out: ', error);
        });
      });

      // Listen for auth state changes
      onAuthStateChanged(auth, (user) => {
        if (user) {
          loginButton.style.display = 'none';
          logoutButton.style.display = 'inline-block';
          actionColumn.style.display = 'table-cell';
        } else {
          loginButton.style.display = 'inline-block';
          logoutButton.style.display = 'none';
          actionColumn.style.display = 'none';
        }
      });
    });
  </script>
</body>
</html>
